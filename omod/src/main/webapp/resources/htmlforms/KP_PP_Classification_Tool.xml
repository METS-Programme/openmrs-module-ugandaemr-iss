<htmlform formName="KP/PP Classification Tool"
          formDescription="KP/PP Classification Tool"
          formEncounterType="5b3b0533-18ee-4b34-aac4-11fdc6d67bb7"
          formUuid="dad7fd3e-eeb0-429a-ad9c-5b52b35da043"
          formVersion="1.0"
          formAddMetadata="yes"
          formUILocation="patientDashboard.visitActions"
          formOrder="1"
          formIcon="icon-medkit"
          formShowIf="(visit.active || !visit.active) &amp;&amp; patient.person.dead==false &amp;&amp; sessionLocation.uuid=='86863db4-6101-4ecf-9a86-5e716d6504e4'"
          formDisplayStyle="Standard"
          formLabel="KP Classification Tool">

    <style type="text/css">

        form#htmlform div.ai-page-frame table>tbody tr:nth-child(odd) td {
        background: #eeeeee;
        }

        form#htmlform div.ai-page-frame table>tbody tr:nth-child(even) td {
        background: #f9f9f9;
        }

        form#htmlform div.ai-page-frame fieldset#child-information table {
        margin: 0 0 5px 0;
        }

        table {
        width: 99%;
        display: inline-block;
        }

        table td {
        background: #B6D6E6;
        color: #404040;
        vertical-align: top;
        }

        .section {
        margin: 20px 0px;
        }

        form .lablex {
        width: 93%;
        }


    </style>
    <script type="text/javascript">
        if(jQuery){
          jQuery(document).ready(function(){
             if ( jq.browser.msie ) {
                jq(":checkbox").click(function(){
                jq(this).change();
                });
             }

               <!--jq(".radio").each(function(){-->
               <!--jq(this).find(":checkbox").attr('type','radio');-->
               <!--});-->


             jq(".enableDisable").each(function(){
                var group = jq(this);
                function disableFn(){
                   group.children("#disabled").fadeTo(250,0.33);
                   group.children("#disabled").find(":checkbox").attr("checked",false); //uncheck
                   group.children("#disabled").find("input[type$='text']").val("");
                   group.children("#disabled").find("input").attr("disabled",true);  //disable
                }
                function enableFn(){
                  group.children("#disabled").fadeTo(250,1);
                  group.children("#disabled").find("input").attr("disabled",false);
                }
                if (jq(this).children("#trigger").find(":checkbox:first").attr("checked") != "checked") {
                disableFn();
                }
             jq(this).children("#trigger").find(":checkbox:first").change(function(){
             var checked = jq(this).attr("checked");
                if(checked == "checked"){
                    enableFn();
                }else{
                    disableFn();
                }
             });
             });

             jq(".triggers").each(function (){
                checkOtherBox("male","msm");

                function checkOtherBox(trigger,triggered){
                    jq("#"+trigger).find(":checkbox:first").change(function(){
                      var checked = jq(this).attr("checked");
                       if(checked == "checked"){
                         jq("#"+triggered).find(":checkbox:first").attr("checked",true);
                       }else{
                         jq("#"+triggered).find(":checkbox:first").attr("checked",false);
                      }
                    });
                }
             });

            jq(".gender").each(function (){
                var group = jq(this);
                function disableFn(){
                   group.children("#gender-other").fadeTo(250,0.33);
                   group.children("#gender-other").find(":radio").attr("checked",false); //uncheck
                   group.children("#gender-other").find("input[type$='text']").val("");
                   group.children("#gender-other").find("input").attr("disabled",true);  //disable
                }
                function enableFn(){
                  group.children("#gender-other").fadeTo(250,1);
                  group.children("#gender-other").find("input").attr("disabled",false);
                }
                var radio_value = "undefined";
                if(radio_value=="undefined"){
                disableFn();
                }
                jq("#your-gender").change(function(){
                radio_value = jq(this).find(":radio:checked").val();
                if(radio_value == "5622"){
                enableFn();
                }
                else{
                disableFn();
                }
             });

            jq(".triggers").change(function(){
               var undefined = "undefined";
               var sexAtBirth = jq("#sex-at-birth").find(":radio:checked").val();
               var sexPartner = jq("#sex-partner").find(":radio:checked").val();
               var sex_worker = jq("#160579").find(":radio:checked").val();
               var drug_user = jq("#160666").find(":radio:checked").val();
               var dc = jq("#6096").find(":radio:checked").val();
               var setting = jq("#165130").find(":radio:checked").val();

               if(sexAtBirth === "90165" &amp;&amp;  (sexPartner === "163290" || sexPartner === "163275")){
                    jq("#msm").find(":checkbox").attr("checked",true);
               }
               else{
                     jq("#msm").find(":checkbox").attr("checked",false);
               }

                <!--transgender checking-->
               var gender = jq("#your-gender").find(":radio:checked").val();
                if(gender !== undefined &amp;&amp; gender !== undefined &amp;&amp; gender !== sexAtBirth){
                     jq("#tg").find(":checkbox").attr("checked",true);
                }
                else{
                     jq("#tg").find(":checkbox").attr("checked",false);
                }

                var occupation = jq("#occupation").find(":checkbox:checked").val();


               var migrant_wrker= jq("#migrant-wrker").find(":checkbox").prop('checked');
               var fisherman = jq("#fisherman").find(":checkbox").prop('checked');
               var truck_driver= jq("#truck-driver").find(":checkbox").prop('checked');
               var uniformed = jq("#uniformed-officers").find(":checkbox").prop('checked');

               checkOtherItem(migrant_wrker , "mw");
               checkOtherItem(fisherman , "ff");
               checkOtherItem(truck_driver , "tkr");
               checkOtherItem(uniformed, "uniformed_officers");

               checkOtherItemIfYes(sex_worker,"sw");
               checkOtherItemIfYes(drug_user,"pwid");
               checkOtherItemIfYes(dc,"dc");

               <!--closed setting or inmate-->
                if(setting === "162277" ){
                   jq("#pip").find(":checkbox").attr("checked",true);
               }
               else if (setting === "165127" || setting === "165128" || setting === "165129") {
                    jq("#closed_setting").find(":checkbox").attr("checked",true);
                     jq("#pip").find(":checkbox").attr("checked",false);
               }
               else{
                    jq("#pip").find(":checkbox").attr("checked",false);
                     jq("#closed_setting").find(":checkbox").attr("checked",false);
               }

               var patientAge = <lookup expression="patient.age" />;
                if(sexAtBirth === "90164" &amp;&amp; patientAge &lt; 25 &amp;&amp; patientAge &gt;=15 ){
                 jq("#agyw").find(":checkbox").attr("checked",true);
                } else{
                 jq("#agyw").find(":checkbox").attr("checked",false);
                }


               function checkOtherItem(trigger_field , field_to_check){
               if(trigger_field == true){
                jq("#"+ field_to_check).find(":checkbox").attr("checked",true);
               }else{
                 jq("#"+ field_to_check).find(":checkbox").attr("checked",false);
               }
               }

               function checkOtherItemIfYes(trigger_field, field_to_check){
                if(trigger_field === "1065"){
               jq("#"+ field_to_check).find(":checkbox").attr("checked",true);
               }
               else{
                 jq("#"+ field_to_check).find(":checkbox").attr("checked",false);
               }
               }
             });
            });
        });
        }
    </script>

    <div class="ai-page-frame">
        <div class="headers" style="text-align: center;">
            <h3>Key and Priority Population (KP/PP) Classification Tool</h3>
        </div>
        <span style="display: none;">
            <encounterLocation default="629d78e9-93e5-43b0-ad8a-48313fd99117"
                               order="629d78e9-93e5-43b0-ad8a-48313fd99117"/>
        </span>

        <section>
            <table width="100%" border="0" cellspacing="0" cellpadding="0">
                <thead>
                    <th colspan="2">
                        Client Classification
                    </th>
                </thead>
                <tbody class="triggers">
                    <tr>

                        <td>
                            <p>
                                <label>1. What was your sex at birth?</label>
                            </p>

                        </td>
                        <td>
                            <p>
                                <obs id="sex-at-birth" conceptId="90252"
                                     answerConceptIds="90165,90164,5622,162570"
                                     answerLabels="Male,Female,Other,Refuse to answer" style="radio" class="vertical-layout-options" />
                            </p>
                        </td>
                    </tr>

                    <tr>

                        <td>
                            <p>
                                <label>2. Currently what do you consider yourself? </label>
                            </p>

                        </td>
                        <td>
                                <span class="gender">
                                    <obs style="radio" id="your-gender" conceptId="165124" answerConceptIds="90165,90164,162570,5622"
                                      answerLabels="Male,Female,Refuse to answer,Other" class="vertical-layout-options" ><br/><br/><br/><br/><br/>
                                     <controls>
                                            <when value="5622" thenDisplay="#gender-other"/>
                                        </controls>
                                    </obs>

                                <span id="gender-other">
                                    <obs conceptId="165135" labelText="Specify:" />
                                </span>
                                </span>

                        </td>
                    </tr>

                    <tr>

                        <td>
                            <p>
                                <label>3. Whom do you have sex with? (consideration for the nonsexually
                                    active) </label>
                            </p>

                        </td>
                        <td>
                            <p>
                                <obs id="sex-partner" conceptId="160109"
                                     answerConceptIds="163290,163291,163275,160573,162570"
                                     answerLabels="Men only,Women only,Both men and women,Not sexually active,Refuse to answer" style="radio" class="vertical-layout-options" />
                             </p>
                        </td>
                    </tr>

                    <tr>

                        <td>
                            <p>
                                <label>4. What is your occupation?  </label>
                            </p>

                        </td>
                        <td>
                            <span  class="enableDisable" id="occupation">
                            <obs id="migrant-wrker" conceptId="1542" answerConceptId="165126" answerLabel="Moves from place to place to do seasonal work" style="checkbox" class="horizontal-layout-options"/><br/> <br/>
                            <obs id="fisherman" conceptId="1542" answerConceptId="159674" answerLabel="Works among fishing communities" style="checkbox" class="horizontal-layout-options"/><br/><br/>
                            <obs id="truck-driver" conceptId="1542" answerConceptId="159466" answerLabel=" Earns a living as a long distance truck driver" style="checkbox" class="horizontal-layout-options" /><br/><br/>
                            <obs id="uniformed-officers" conceptId="1542" answerConceptId="165125" answerLabel="Uniformed Officers" style="checkbox" class="horizontal-layout-options"/><br/><br/>
                            <obs id="not-applicable" conceptId="1542" answerConceptId="1175" answerLabel="Not applicable" style="checkbox" class="horizontal-layout-options" /><br/><br/>
                                <obs id="trigger"  conceptId="1542" answerConceptId="5622"
                                 answerLabel="Other" />
                            <span id="disabled">
                                <obs conceptId="165136" labelText="Specify:" />
                            </span>

                            <obs id="refused_to_answer" conceptId="1542" answerConceptId="162570" answerLabel="Refuse to answer" style="checkbox" class="horizontal-layout-options" /><br/>
                            </span>
                        </td>
                    </tr>

                    <tr>

                        <td>
                            <p>
                                <label>5. Is selling sex or exchange of sex for gifts your source of income?</label>
                            </p>

                        </td>
                        <td>

                            <p>
                                <obs id="160579" conceptId="160579" style="radio"
                                     answerConceptIds="1065,1066,162570"
                                     answerLabels="Yes,No,Refuse to answer" class="vertical-layout-options"/>
                            </p>
                        </td>
                    </tr>

                    <tr>

                        <td>
                            <p>
                                <label>6. In the last 6 months, have you injected drugs to make
                                    yourself feel high?
                                </label>
                            </p>

                        </td>
                        <td>
                            <p>
                                <obs id="160666" conceptId="160666" style="radio"
                                     answerConceptIds="1065,1066,162570"
                                     answerLabels="Yes,No,Refuse to answer" class="vertical-layout-options"/>
                            </p>
                        </td>
                    </tr>

                    <tr>

                        <td>
                            <p>
                                <label>7. Are you in discordant relationship where you are HIV negative
                                    and your partner is HIV positive?
                                </label>
                            </p>

                        </td>
                        <td>
                            <p>
                                <obs id="6096" conceptId="6096" style="radio"
                                     answerConceptIds="1065,1066,1067,162570"
                                     answerLabels="Yes,No,Do not Know,Refuse to answer" class="vertical-layout-options"/>
                            </p>
                        </td>
                    </tr>

                    <tr>

                        <td>
                            <p>
                                <label>8. Are you in a prison or closed settings setting Incarcerated? </label>
                            </p>

                        </td>
                        <td>
                            <p>
                                <obs id="165130" conceptId="165130" style="radio"
                                     answerConceptIds="162277,165127,165128,165129,1175,162570"
                                      class="vertical-layout-options"/>

                            </p>
                        </td>
                    </tr>

                </tbody>

            </table>
        </section>
        <section>
            <table width="100%">
                <thead>
                    <th>
                Key Population /PP Classification( Tick All that Apply)
                    </th>
                    <th> Classify</th>
                </thead>
                <tbody>
                    <tr>
                        <td>
                            If client answers Male to Q1, Men Only or Men and Women to Q3, then classify as Man who has
                            Sex with Men (MSM)
                        </td>
                        <td>
                            <obs id="msm" conceptId="165133" answerConceptId="160578" answerLabel="MSM" class="horizontal-layout-options"/>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            if client identifies as a gender different from their birth sex, then classify as Transgender (TG)
                        </td>
                        <td>

                            <obs id="tg" conceptId="165133" answerConceptId="165131" answerLabel="TG" class="horizontal-layout-options"/>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            If clients answers Moves from place to place to do seasonal work to Q4, then classify as Migrant
                            Worker (MW)
                        </td>
                        <td>
                            <obs id="mw" conceptId="165133" answerConceptId="165126" answerLabel="MW" class="horizontal-layout-options"/>

                        </td>
                    </tr>
                    <tr>
                        <td>
                            If Client answers works among fishing communities to Q4, then classify as Fisher Folk (FF)
                        </td>
                        <td>
                            <obs id="ff" conceptId="165133" answerConceptId="159674" answerLabel="FF" class="horizontal-layout-options"/>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            If client answers earns a living as a long distance truck driver to Q4, then classify as Trucker (TKR)
                        </td>
                        <td>
                            <obs id="tkr" conceptId="165133" answerConceptId="162198" answerLabel="TKR" class="horizontal-layout-options"/>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            If client answers works with Police/Military/Prisons/ UWA as Game Warder/private security services
                            to Q4 then classify as Uniformed Officers
                        </td>
                        <td>
                            <obs id="uniformed_officers" conceptId="165133" answerConceptId="165125" answerLabel="Uniformed officers" class="horizontal-layout-options"/>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            If client answers Yes to Q5, then categorize as Sex Worker (SW)
                        </td>
                        <td>
                            <obs id="sw" conceptId="165133" answerConceptId="160579" answerLabel="SW" class="horizontal-layout-options"/>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            If client answers Yes to Q6, then classify as Person Who Injects Drugs (PWID)
                        </td>
                        <td>
                            <obs id="pwid" conceptId="165133" answerConceptId="160666" answerLabel="PWID" class="horizontal-layout-options"/>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            If client answers Yes to Q7, then categorize as Discordant Couple (DC)
                        </td>
                        <td>
                            <obs id="dc" conceptId="165133" answerConceptId="6096" answerLabel="DC" class="horizontal-layout-options"/>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            If client answers Female to Q1 and is aged 15-24 years classify as Young woman and adolescent
                            girl (AGYW)
                        </td>
                        <td>
                            <obs id="agyw" conceptId="165133" answerConceptId="165132" answerLabel="AGYW" class="horizontal-layout-options"/>
                        </td>
                    </tr>
                    <tr>
                        <td>
                            If client answers inmate to Q8,the classify as Person in Prison (PIP)
                        </td>
                        <td>
                            <obs id="pip" conceptId="165133" answerConceptId="162277" answerLabel="PIP" class="horizontal-layout-options"/>
                        </td>
                    </tr>

                    <tr>
                        <td>
                            If client answers refugee camp, remand home and rehabilitation centers to Q8, then classify as
                            Person in Closed Setting
                        </td>
                        <td>
                            <obs id="closed_setting" conceptId="165133" answerConceptId="165130" answerLabel="Person in Closed Setting" class="horizontal-layout-options"/>
                        </td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section>
            <table>
                <thead>
                    <th>Final Classification: (Tick dominant category)</th>

                </thead>

                <tbody>
                <tr>
                    <td>
                        <obs  conceptId="165134" answerConceptId="160578" answerLabel="MSM" />

                        <obs  conceptId="165134" answerConceptId="165131" answerLabel="TG" />

                        <obs  conceptId="165134" answerConceptId="160579" answerLabel="SW" />

                        <obs  conceptId="165134" answerConceptId="160666" answerLabel="PWID" />

                        <obs  conceptId="165134" answerConceptId="165126" answerLabel="MW" />

                        <obs  conceptId="165134" answerConceptId="165132" answerLabel="AGYW" />

                        <obs  conceptId="165134" answerConceptId="6096" answerLabel="DC" />

                        <obs  conceptId="165134" answerConceptId="162198" answerLabel="TKR" />

                        <obs  conceptId="165134" answerConceptId="159674" answerLabel="FF" />

                        <obs  conceptId="165134" answerConceptId="160578" answerLabel="Person in Prison" />

                        <obs  conceptId="165134" answerConceptId="1107" answerLabel="None"  />
                    </td>
                </tr>
                    <tr>
                        <td>
                            <span>
                                <strong>*Some clients may belong to more than one category due to overlapping vulnerabilities and behavior</strong>
                            </span>
                        </td>
                    </tr>

                </tbody>
            </table>

        </section>
    </div>
    <section>
        <submit/>
    </section>
</htmlform>